!function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}(),a=function c(t,e,a){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:c(r,e,a)}if("value"in i)return i.value;var n=i.get;if(void 0!==n)return n.call(a)},i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},n=function h(e,a,i){t(this,h),this.width=a.canvasWidth-a.padding[0]-a.padding[2],this.height=a.canvasHeight-a.padding[1]-a.padding[3],this.translateX=a.padding[0],this.translateY=a.padding[1],this.element=e.append("g").attr("class","drawingArea").attr("transform","translate("+this.translateX+", "+this.translateY+")").attr("width",this.width).attr("height",this.height),i&&i(this)},o=function(){function a(e,i,r){t(this,a),this.width=i.canvasWidth,this.height=i.canvasHeight,this.config=i,this.svg=this.createSvgCanvas(e),this.drawingArea=new n(this.svg,i),this.dataGroup=this.createDataGroup(this.drawingArea.element),this.tooltip=this.createToolTip(),this.data={},this.init(),r&&r(this)}return e(a,[{key:"getData",value:function(t,e){var a=this;d3.json(t,function(t,i){a.data=a.postprocessData(i),e&&e(t,a.data)})}},{key:"drawGraph",value:function(){this.createGraph(this.dataGroup),this.drawXaxis(this.drawingArea.element),this.drawYaxis(this.drawingArea.element),this.drawXaxisLabel(this.drawingArea.element),this.drawYaxisLabel(this.drawingArea.element)}},{key:"createGraph",value:function(t){var e=t.selectAll(".dataItem").data(this.data);this.itemsExit(e.exit()),this.itemsEnter(e.enter()),this.itemsUpdate(e),this.axisX=this.createXaxis(),this.axisY=this.createYaxis()}},{key:"init",value:function(){}},{key:"postprocessData",value:function(t){var e=t.map(function(t){return t[0]}),a=d3.min(e),i=d3.max(e),r=t.map(function(t){return t[1]}),n=d3.min(r),o=d3.max(r);return this.scaleX=d3.scale.linear().domain([a,i]).range([0,this.drawingArea.width]),this.scaleY=d3.scale.linear().domain([n,o]).range([0,this.drawingArea.height]),t}},{key:"itemsExit",value:function(t){t.remove()}},{key:"itemsEnter",value:function(t){var e=this;t.append("g").attr("class","dataItem").on("mouseover",function(t){return e.onMouseOver(t)}).on("mouseout",function(){return e.onMouseOut()})}},{key:"itemsUpdate",value:function(t){}},{key:"createXaxis",value:function(){return d3.svg.axis().scale(this.scaleX).ticks(20).orient("bottom")}},{key:"drawXaxis",value:function(t){t.append("g").attr("class","x axis").attr("transform","translate(0, "+this.drawingArea.height+")").call(this.axisX)}},{key:"createYaxis",value:function(){return d3.svg.axis().scale(this.scaleY).ticks(20).orient("left")}},{key:"drawYaxis",value:function(t){t.append("g").attr("class","y axis").call(this.axisY)}},{key:"drawYaxisLabel",value:function(t){return t.append("text").attr("class","y axis label").text(this.config.labelY).attr("text-anchor","end").attr("transform","rotate(-90) translate(-5,15)")}},{key:"drawXaxisLabel",value:function(t){return t.append("text").attr("class","x axis label").text(this.config.labelX).attr("text-anchor","middle").attr("x",this.drawingArea.width/2).attr("y",this.drawingArea.height-5)}},{key:"onMouseOver",value:function(t){var e=this.tooltipSetContent(t);""!==e&&(this.tooltip.transition().duration(200).style("opacity",.9),this.tooltip.style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-30+"px"),this.tooltip.html(this.tooltipSetContent(t)))}},{key:"onMouseOut",value:function(){this.tooltip.transition().duration(500).style("opacity",0)}},{key:"tooltipSetContent",value:function(t){return t[0]+" - "+t[1]}},{key:"createSvgCanvas",value:function(t){return d3.select(t).append("svg").attr("class","svgCanvas").attr("width",this.config.canvasWidth).attr("height",this.config.canvasHeight)}},{key:"createDataGroup",value:function(t){return t.append("g").attr("class","dataGroup")}},{key:"createToolTip",value:function(){return d3.select("body").append("div").attr("class","tooltip").style("opacity",0)}}]),a}(),s=function(n){function o(){return t(this,o),r(this,Object.getPrototypeOf(o).apply(this,arguments))}return i(o,n),e(o,[{key:"init",value:function(){this.colorsInterpolator=d3.interpolateHsl(d3.hsl(0,1,.5),d3.hsl(240,1,.5)),this.months=["January","February","March","April","May","June","July","August","September","October","November","December"]}},{key:"getcolor",value:function(t){var e=(t-this.minTemp)/(this.maxTemp-this.minTemp),a=240*(1-e);return d3.hsl(a,1,.5).rgb()}},{key:"postprocessData",value:function(t){var e=t.baseTemperature;t=t.monthlyVariance;var a=t.map(function(t){return t.year}),i=d3.min(a),r=d3.max(a),n=t.map(function(t){return t.temperature=e+t.variance,t.temperature});return this.minTemp=d3.min(n),this.maxTemp=d3.max(n),this.scaleX=d3.scale.ordinal().domain(d3.range(i,r+1)).rangeBands([0,this.drawingArea.width],0,0),this.scaleY=d3.scale.ordinal().domain(d3.range(1,13)).rangeBands([0,this.drawingArea.height],0,0),this.colorScale=d3.scale.quantile().domain([this.minTemp,this.maxTemp]).range(this.config.colorMap),this.axisScaleX=d3.scale.linear().domain([i,r]).range([0,this.drawingArea.width]),t}},{key:"createYaxis",value:function(){var t=this,e=a(Object.getPrototypeOf(o.prototype),"createYaxis",this).call(this);return e.tickFormat(function(e){return t.months[e-1]})}},{key:"createXaxis",value:function(){var t=d3.svg.axis().scale(this.axisScaleX).ticks(20).tickFormat(function(t){return t.toString()}).orient("bottom");return t}},{key:"drawXaxisLabel",value:function(t){var e=a(Object.getPrototypeOf(o.prototype),"drawXaxisLabel",this).call(this,t);e.attr("x",this.drawingArea.width/2).attr("y",this.drawingArea.height+45)}},{key:"drawYaxisLabel",value:function(t){var e=a(Object.getPrototypeOf(o.prototype),"drawYaxisLabel",this).call(this,t);e.attr("transform","rotate(-90) translate(-"+this.drawingArea.height/2+",-80)").attr("text-anchor","middle")}},{key:"itemsEnter",value:function(t){var e=this;t.append("rect").attr("class",function(t){return"dataItem "+t.month+" "+t.year}).attr("r",5).attr("x",function(t){return e.scaleX(t.year)}).attr("y",function(t){return e.scaleY(t.month)}).attr("fill",function(t){return e.colorScale(t.temperature)}).attr("stroke",function(t){return e.colorScale(t.temperature)}).attr("width",function(){return e.scaleX.rangeBand()}).attr("height",function(){return e.scaleY.rangeBand()}).on("mouseover",function(t){return e.onMouseOver(t)}).on("mouseout",function(){return e.onMouseOut()})}},{key:"onMouseOver",value:function(t){var e=this.tooltipSetContent(t);if(""!==e){this.tooltip.transition().duration(200).style("opacity",.9);var a=-10;d3.event.pageX>this.width/2&&(a=d3.select("div.tooltip").property("offsetWidth"));var i=d3.select("div.tooltip").property("offsetHeight");this.tooltip.style("left",d3.event.pageX-a+"px").style("top",d3.event.pageY-i/2+"px"),this.tooltip.html(this.tooltipSetContent(t))}}},{key:"tooltipSetContent",value:function(t){return"<h3>"+this.months[t.month-1]+" "+t.year+"</h3><strong>"+t.temperature.toFixed(3)+"°C</strong><br>"+t.variance+"°C"}},{key:"drawGraph",value:function(){var t=this;a(Object.getPrototypeOf(o.prototype),"drawGraph",this).call(this);var e=40,i=20,r=this.width-e*this.config.colorMap.length-20,n=this.height-i-25,s=this.svg.append("g").attr("class","legend").attr("transform","translate("+r+","+n+")");this.config.colorMap.forEach(function(a,r){s.append("rect").attr("class","heatmapColor").attr("width",e).attr("height",i).attr("x",r*e).attr("y",0).attr("fill",a);var n=t.colorScale.invertExtent(a),o=((n[0]+n[1])/2).toFixed(1);s.append("text").attr("text-anchor","middle").attr("x",r*e+e/2).attr("y",i+10).text(o+"°C")})}}]),o}(o),l={canvasWidth:1200,canvasHeight:600,padding:[110,10,10,100],dataUrl:"datasets/global-temperature.json",labelX:"Years",labelY:"Months",colorMap:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]};new s(".plot",l,function(t){t.getData(l.dataUrl,function(e,a){t.drawGraph()})})}();